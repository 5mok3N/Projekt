<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="utf-8">
  <title>Lokalizacja i warstwy - 10397</title>
  <link rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
        integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI="
        crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
          integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM="
          crossorigin=""></script>
  <style>
    .myPopup .leaflet-popup-content-wrapper,
    .myPopup .leaflet-popup-tip {
      background: #333;
      color: #fff;
    }
    #coordPanel {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(255, 255, 255, 0.8);
      padding: 5px;
      z-index: 999;
      font-family: Arial, sans-serif;
    }
    #map {
      width: 900px; 
      height: 600px; 
      border: 1px solid #aaa;
    }
  </style>
</head>
<body>
  <h2>Moja mapa - student nr 10397</h2>
  <div id="map"></div>
  <div id="coordPanel">Lat: ---, Lng: ---</div>

  <script>
    const map = L.map('map', {
      center: [52.231838, 21.006724],
      zoom: 12
    });

    const osmLayer = L.tileLayer(
      'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
      {
        attribution: '© OpenStreetMap'
      }
    ).addTo(map);

    const wmsOrto = L.tileLayer.wms(
      'https://mapy.geoportal.gov.pl/wss/service/PZGIK/ORTO/WMS/StandardResolution',
      {
        layers: 'Raster',
        format: 'image/png',
        transparent: true,
        version: '1.3.0',
        attribution: 'Dane: © Geoportal Orto'
      }
    );

    const wmsTopo = L.tileLayer.wms(
      'https://mapy.geoportal.gov.pl/wss/service/img/guest/TOPO/MapServer/WMSServer',
      {
        layers: 'Raster',
        format: 'image/png',
        transparent: true,
        version: '1.3.0',
        attribution: 'Dane: © Geoportal Topo'
      }
    );

    const circleMarker = L.circle([52.232, 21.00], {
      radius: 300,
      color: 'red',
      fillColor: '#f03',
      fillOpacity: 0.4
    }).bindPopup('Okrąg').addTo(map);

    const polygon = L.polygon([
      [52.23, 21.005],
      [52.232, 21.008],
      [52.228, 21.010]
    ], {
      color: 'green',
      fillColor: 'green',
      fillOpacity: 0.2
    }).bindPopup('Polygon').addTo(map);

    const rectangle = L.rectangle([
      [52.235, 21.010],
      [52.238, 21.015]
    ], {
      color: 'blue',
      weight: 2
    }).bindPopup('Prostokąt').addTo(map);

    let geojsonLayer;

    fetch('data/mojaWarstwa.geojson')
      .then(response => response.json())
      .then(data => {
        geojsonLayer = L.geoJSON(data, {
          onEachFeature: (feature, layer) => {
            layer.bindTooltip(feature.properties.name);
            layer.bindPopup(`<b>${feature.properties.name}</b><br/>${feature.properties.opis}`);
          },
          style: {
            color: 'orange',
            weight: 2
          }
        }).addTo(map);

        if (geojsonLayer.getBounds) {
          map.fitBounds(geojsonLayer.getBounds());
        }
      })
      .catch(error => console.error('Błąd wczytywania GeoJSON:', error));

    const baseMaps = {
      'OSM': osmLayer,
      'Orto (WMS)': wmsOrto,
      'Topo (WMS)': wmsTopo
    };

    const overlays = {
      'Okrąg': circleMarker,
      'Poligon': polygon,
      'Prostokąt': rectangle
      // 'GeoJSON': geojsonLayer  // można dodać po wczytaniu pliku
    };

    L.control.layers(baseMaps, overlays).addTo(map);

    map.on('mousemove', e => {
      document.getElementById('coordPanel').innerHTML =
        'Lat: ' + e.latlng.lat.toFixed(5) + ', Lng: ' + e.latlng.lng.toFixed(5);
    });

    L.control.scale().addTo(map);
  </script>
</body>
</html>
